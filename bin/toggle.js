#!/usr/bin/env node
// Generated by CoffeeScript 1.12.6
(function() {
  var NPM, TAOBAO, command, exec, green, npm, publish, ref, registry, script, taobao, url, version, yellow;

  TAOBAO = 'https://registry.npm.taobao.org/';

  NPM = 'https://registry.npmjs.org/';

  exec = require('execa');

  command = require('commander');

  version = require('../package').version;

  ref = require('colors/safe'), green = ref.green, yellow = ref.yellow;

  command.usage((green('--taobao')) + " or " + (green('--npm'))).version(version).option('-t, --taobao', 'set taobao registry').option('-n, --npm', 'set npm registry').option('-r, --registry', 'show current registry').option('-p, --publish', 'switch to npm repo and run publish and switch to taobao repo').parse(process.argv);

  taobao = command.taobao, npm = command.npm, registry = command.registry, publish = command.publish;

  if (!((taobao != null) || (npm != null) || (registry != null) || (publish != null))) {
    command.help();
  }

  url = taobao != null ? TAOBAO : NPM;

  script = registry ? 'npm config get registry' : "npm config set registry " + url;

  if (publish) {
    exec.shell("npm config set registry " + NPM).then(function() {
      console.log("npm registry has switched to npm");
      return exec.shell("npm publish");
    }).then(function() {
      return exec.shell("npm config set registry " + TAOBAO);
    }).then(function() {
      return console.log("npm registry has switched to taobao");
    });
  } else {
    exec.shell(script).then(function(arg) {
      var stdout;
      stdout = arg.stdout;
      if (!registry) {
        return console.log("npm registry has switched to " + (yellow(url)));
      } else {
        return console.log("current registry is " + (yellow(stdout)));
      }
    })["catch"](console.error);
  }

}).call(this);
